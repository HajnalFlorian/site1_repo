<!DOCTYPE html>
<html>
<head>
	<title>cours - HTTP Request</title>
	<style type="text/css">
		h1 { color:  #FF0000 }
		textarea 
		{
			border-width: 8px;
			border-radius: 8px;
		}
	</style>
	<meta charset="utf-8">
</head>
<body>

	<h1>Cours HTTP Request</h1>

<h2>Requête .xml</h2>

<!-- Bouton qui lance la méthode de chargement du xml -->
<button onclick="getXML(), splitxml();">Charger le XML</button>

<!-- Tableau recevant les valeurs -->
<div id="table">

    <textarea id="area_films"  rows="20" cols="50"></textarea>
    <textarea id="area_titres"  rows="10" cols="30"></textarea>
    <textarea id="area_split" rows="20" cols="30"></textarea>
    <br>
    <textarea id="area_infos"  rows="10" cols="83"></textarea>

</div>

<div>
	<select name="select_idReal" id="id_selection_idReal" onchange="OnSelectDisplay(this);" multiple>
    <option id="option1">Veuillez selectionner une option</option>

</select>

</div>

<script type="text/javascript">

	function getXML()
	{
		//Création de l'objet
    	var xhttp = new XMLHttpRequest();

   	 	xhttp.onreadystatechange = function() 
   	 	{
	        if (xhttp.readyState == 4 && xhttp.status == 200)//Quand la requête est terminée
	        {
	        	//Récupère le contenu du .xml
	            var parser = new DOMParser();
	            XMLDoc = parser.parseFromString(this.responseText, "text/html");

	            //Récupère les éléments du .xml
	            document.getElementById("area_films").innerHTML = this.responseText;
	            var films = XMLDoc.getElementsByTagName("titre");
	            var titres = "";
	            var infos = "";
	            var reals = XMLDoc.getElementsByTagName("realisateur");
	            var dates = XMLDoc.getElementsByTagName("date");
	            
	            //Boucle dans ce fichier pour récupérer les informations 
	            for (let index = 0; index < films.length; index++) 
	            {
	                const element = films[index];
	                const element2 = reals[index];
	                const element3 = dates[index];

	                titres = titres + element.innerHTML + "\n";
	                infos = infos + "Film : " + element.innerHTML + "--- Réalisateur : " + element2.innerHTML + "--- Date : " + element3.innerHTML + "\n";
            	}

            document.getElementById("area_titres").innerHTML = titres;
            document.getElementById("area_infos").innerHTML = infos;
        }
    };

    xhttp.open("GET", "MesFilms.xml", true);
    xhttp.send();
}

var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
   if (this.readyState == 4 && this.status == 200) {
       myFunction(this);
   }
};


	function splitxml()
	{
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function()
		{
			if (xhttp.readyState == 4 && xhttp.status == 200)
			{
				var strDoc = this.responseText;

				//création de split
				var sTitre = strDoc.split('<titre>');
				var sRealisateur = strDoc.split('<realisateur>');
				var sDate = strDoc.split('<date>');

				//création de tableau qui vous récup les chaine de caractère donner par les split
				var tabTitre = [''];
				var tabRealisateur = [''];
				var tabDate = [''];

				//traitement 
				for (var i = 0; i < sTitre.length; i++) 
				{
					tabTitre[i]	= sTitre[i].split('</titre>');
					tabRealisateur[i] = sRealisateur[i].split('</realisateur>');
					tabDate[i] = sDate[i].split('</date>');

					//affichage

					document.getElementById('area_split').innerHTML += "Titre: " + tabTitre[i][0]+" / Realisateur: " + tabRealisateur[i][0] + " / Date: " + tabDate[i][0];
				}

			}
		}
		    xhttp.open("GET", "MesFilms.xml", true);
  	 		xhttp.send();
	}


</script>
<script type="text/javascript">

	//Variable globale qui reçoit le contenu du fichier xml (string)	
	var xmlStr;
	
	function Init()
	{
		var xhttp = new XMLHttpRequest();

   	 	xhttp.onreadystatechange = function() 
   	 	{
	        if (xhttp.readyState == 4 && xhttp.status == 200)//Quand la requête est terminée
	        {
	        	var parser = new DOMParser();
				var XMLDoc = parser.parseFromString(this.responseText, "text/html");

				//Le charge dans une variable globale
				xmlStr = parser.parseFromString(this.responseText, "text/html");

				var x = XMLDoc.getElementsByTagName('film');
				var liste = document.getElementById('id_selection_idReal');

			 	//Boucle ajoutant les options dans le select
			 	for(i = 0; i < x.length; i++)
			 	{
			 		var option = document.createElement('option');
			 		option.setAttribute("value", x[i].getAttribute('idreal'));
			 		var text = document.createTextNode(x[i].getAttribute('idreal'));
			 		option.appendChild(text);
			 		liste.appendChild(option);
			 	}

        	}
   		}

	    xhttp.open("GET", "MesFilms.xml", true);
	    xhttp.send();


	}

	function OnSelectDisplay(selectObject) 
	{

		//Récupère les films
		var x = xmlStr.getElementsByTagName('film');

		//Récupère le conteneur dans lequel les résultats seront stockés
		var liste = document.getElementById('listeResultat');
		liste.innerHTML = '';

		//Si les options selectionnées du select correspondent 
		//à des idreal de film dans le fichier, les ajoute à une liste
		for(i = 0; i < x.length; i++)
		{
			for(var j = 0; j < selectObject.selectedOptions.length; j++)
			{
				if(x[i].getAttribute('idreal') == selectObject.selectedOptions[j].value)
				{

					//Créer un li contenant le titre du film, qui sera rajouté dans une liste
					var li = document.createElement('li');
					var txt = document.createTextNode(x[i].firstChild.nextSibling.firstChild.textContent);
					li.appendChild(txt);
					document.getElementById('listeResultat').appendChild(li);
					//-------------------------------------------------------//

				}
			}
			
		}
	}





</script>
    <!-- Conteneur dans lequel la liste des films sera affichée -->
<ul id="listeResultat">
    
</ul>

</body>
</html>