<!DOCTYPE html>
<html>
<head>
	<title>cours - HTTP Request</title>
	<style type="text/css">
		h1 { color:  #FF0000 }
		textarea 
		{
			border-width: 8px;
			border-radius: 8px;
		}
	</style>
	<meta charset="utf-8">
</head>
<body>

	<h1>Cours HTTP Request</h1>

<h2>Requête .xml</h2>

<!-- Bouton qui lance la méthode de chargement du xml -->
<button onclick="getXML(), splitxml();">Charger le XML</button>

<!-- Tableau recevant les valeurs -->
<div id="table">

    <textarea id="area_films"  rows="20" cols="50"></textarea>
    <textarea id="area_titres"  rows="10" cols="30"></textarea>
    <textarea id="area_split" rows="20" cols="30"></textarea>
    <br>
    <textarea id="area_infos"  rows="10" cols="83"></textarea>

</div>

<div>
	

</div>

<script type="text/javascript">

	function getXML()
	{
		//Création de l'objet
    	var xhttp = new XMLHttpRequest();

   	 	xhttp.onreadystatechange = function() 
   	 	{
	        if (xhttp.readyState == 4 && xhttp.status == 200)//Quand la requête est terminée
	        {
	        	//Récupère le contenu du .xml
	            var parser = new DOMParser();
	            XMLDoc = parser.parseFromString(this.responseText, "text/html");

	            //Récupère les éléments du .xml
	            document.getElementById("area_films").innerHTML = this.responseText;
	            var films = XMLDoc.getElementsByTagName("titre");
	            var titres = "";
	            var infos = "";
	            var reals = XMLDoc.getElementsByTagName("realisateur");
	            var dates = XMLDoc.getElementsByTagName("date");
	            
	            //Boucle dans ce fichier pour récupérer les informations 
	            for (let index = 0; index < films.length; index++) 
	            {
	                const element = films[index];
	                const element2 = reals[index];
	                const element3 = dates[index];

	                titres = titres + element.innerHTML + "\n";
	                infos = infos + "Film : " + element.innerHTML + "--- Réalisateur : " + element2.innerHTML + "--- Date : " + element3.innerHTML + "\n";
            	}

            document.getElementById("area_titres").innerHTML = titres;
            document.getElementById("area_infos").innerHTML = infos;
        }
    };

    xhttp.open("GET", "MesFilms.xml", true);
    xhttp.send();
}

var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
   if (this.readyState == 4 && this.status == 200) {
       myFunction(this);
   }
};


	function splitxml()
	{
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function()
		{
			if (xhttp.readyState == 4 && xhttp.status == 200)
			{
				var strDoc = this.responseText;

				//création de split
				var sTitre = strDoc.split('<titre>');
				var sRealisateur = strDoc.split('<realisateur>');
				var sDate = strDoc.split('<date>');

				//création de tableau qui vous récup les chaine de caractère donner par les split
				var tabTitre = [''];
				var tabRealisateur = [''];
				var tabDate = [''];

				//traitement 
				for (var i = 0; i < titre.length; i++) 
				{
					tabTitre[i]	= titre[i].split('</titre>');
					tabRealisateur[i] = sRealisateur[i].split('</realisateur>');
					tabDate[i] = sDate[i].split('</date>');

					//affichage

					document.getElementById('area_split').innerHTML += "Titre: " + tabTitre[i][0]+" / Realisateur: " + tabRealisateur[i][0] + " / Date: " + tabDate[i][0];
				}

			}
		}
		    xhttp.open("GET", "MesFilms.xml", true);
  	 		xhttp.send();
	}


</script>


</body>
</html>